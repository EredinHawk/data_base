# Проектирование базы данных

### Цель
    Спроектировать базу данных существующего проекта (Aviasales — сервис для покупки дешевых авиабилетов) и реализовать REST API для работы с данными.

### Задачи
    1. Определить основные сущности
    2. Составить модель базы данных с использованием UML
    3. Развернуть локальный сервер PostgreSQL
    4. Спроектировать БД
    5. Определить конечные точки API
    6. Реализовать CRUD

## Реализация

### 1. Определение сущностей

Сущности определяются исходя из бизнес требований, которые задаются заказчиком на самом высоком уровне абстракции будущей модели БД. Уровни абстракции задают степень детализации будущей модели. Начиная от бизнес модели, которая определяет требования к продукту и заканчивая физическим уровнем, в котором отображены все детали будущей БД с учетом используемой СУБД (отношения, ключи, индексы, связи и т.д.). 

![alt text](/img/Карточки.png)

Сымитируем упрощенные требования заказчика:

- Результат поиска должен быть оформлен в виде блоков.
- В каждом блоке должны быть указаны:

    1. Город вылета
    2. Город назначения
    3. Время вылета
    4. Время прилета в пункт назначения
    5. Стоимость авиабилета
    6. Расчетное время полета
    7. Авиакомпания, обслуживающая авиаперелет

Пока остановимся на этом и выделим сущности из требований:

#### 1. Аэропорт

 Почему не город? Потому что в одном городе может быть несколько аэропортов. Город базирования же будет атрибутом в отношении "airport", а города стоит вынести как отдельную сущность и связать ключом.

 Атрибуты:

 - id - уникальный идентификатор аэропорта
 - name - название аэропорта
 - city_id - город базирования аэропорта

 Список можно продолжать бесконечно, ведь у аэропортов множество характеристик. Круто конечно учесть все параметры, но ключевая задача понять принцип проектирования БД.

#### 2. Город

Связующая сущность, которая упростит восприятие БД и поможет фильтровать результат при запросах.

Атрибуты:

- id - уникальный идентификатор города
- name - название города
- time - часовой пояс (важно при расчете времени прибытия)

#### 3. Авиакомпания

Авиакомпания, как сущность, крайне насыщенна характеристиками, но в контексте поиска авиабилетов достаточны будут:

 - id - уникальный идентификатор авиакомпании
 - name - название авиакомпании

 #### 4. Рейс

 Основная сущность в которую будут включены атрибуты предыдущих таблиц.

- id - уникальный идентификатор рейса
- flight - номер рейса (например SU 202)
- airline_id - id авиакомпании которая обслуживает рейс
- depart_airport_id - аэропорт вылета
- dest_airport_id - аэропорт назначения
- time - дата и время начала рейса
- cost - стоимость рейса на 1 эконом место

Почему у рейса есть и идентификатор и номер рейса одновременно? Потому что номер рейса повторяется с течением времени, а id указывает на уникальность конкретного рейса в данный момент времени.

Видим избыточность в сущности "Рейс". Можно также добавить "Билет", который заберет на себя атрибут cost, или объеденить аэропорт вылета/прилета в один связующий атрибут, который связан с сущностью "Маршруты", но для тренировки пока хватит и этого.

```bash
Количество сущностей будет непременно расти с каждым уточняющем вопросом к заказчику и от сложности проекта. Поэтому и придуманы уровни абстракции, которые от низкой детализации сущностей постепенно переходят к более высокой степени точности. Не будем проектировать каждый уровень, а остановимся на даталогическом уровне проектирования.

Важно понимать, что ошибки обязательно будут и учесть все сразу не получится. Поэтому проектирование это постоянный процесс в разработке. Так или иначе придется залезть в БД и добавить новые атрибуты или сущности.
```

### 2. Составление модели

Теперь вышеописанные сущности необходимо отобразить в статической UML диаграмме и обозначить связи.

```bash
В объектах UML диаграммы баз данных принято отображать ключи как методы, потому что в контексте СУБД определить ключ - это процесс а не просто свойство атрибута. В данном примере для простоты восприятия ключи будут отображены непосредственно в строках атрибутов.
```


