# Проектирование базы данных

### Цель
Спроектировать базу данных существующего проекта (Aviasales — сервис для покупки дешевых авиабилетов) и реализовать REST API для работы с данными.

### Задачи
    1. Определить основные сущности
    2. Составить модель базы данных с использованием UML
    3. Развернуть локальный сервер PostgreSQL
    4. Спроектировать БД
    5. Определить конечные точки API
    6. Реализовать CRUD

## Реализация

### 1. Определение сущностей

Моделирование БД состоит из множетства этапов, первый из которых - это опеределить сущности исходя из бизнес требований заказчика. Это буквально диалог с клиентом, во время которого изучается технические и логические аспекты отрасли. Если требуется разработать продукт для финансовой компании, то сущности будут примерно такими:

1. Счет
2. Транзакция
3. Заем
4. и т.п.

Рассмотрим этот этап проектирования в контексте нашей задачи:

![alt text](/img/Карточки.png)

При поиске авиабилетов видим блоки с информацие об авиарейсах. Сымитируем упрощенные требования заказчика:

- Результат поиска должен быть оформлен в виде блоков.
- В каждом блоке должны быть указаны:

```bash
    Город вылета
    Город назначения
    Время вылета
    Время прилета в пункт назначения
    Стоимость авиабилета
    Расчетное время полета
    Авиакомпания, обслуживающая авиаперелет
```

Пока остановимся на этом и выделим сущности из требований:

#### 1. Аэропорт

 Почему не город? Потому что в одном городе может быть несколько аэропортов. Город базирования же будет атрибутом в отношении "airport", а города стоит вынести как отдельную сущность и связать ключом.

 Атрибуты:

    a_id      - уникальный идентификатор аэропорта
    a_name    - название аэропорта
    a_city_id - город базирования аэропорта

 Список можно продолжать бесконечно, ведь у аэропортов множество характеристик. Конечно хочется учесть все параметры, но на данном этапе ключевая задача понять принцип проектирования БД.

#### 2. Город

Связующая сущность, которая упростит восприятие БД и поможет фильтровать результат при запросах.

Атрибуты:

    c_id   - уникальный идентификатор города
    c_name - название города
    c_time- часовой пояс (важно при расчете времени прибытия)

#### 3. Авиакомпания

Авиакомпания, как сущность, крайне насыщенна характеристиками, но в контексте поиска авиабилетов достаточны будут:

Атрибуты:

    a_id   - уникальный идентификатор авиакомпании
    a_name - название авиакомпании

#### 4. Маршрут

У авиакомпаний фиксированные маршруты. Следует вынести детали маршрутов в отдельную сущность, чтобы избавиться от избыточности.

Атрибуты:

    r_id             - уникальный идентификатор машрута
    r_airport_depart - город отправления
    r_airport_dest   - город назначения
    r_way            - время в пути

#### 5. Рейс

 Основная сущность в которую будут включены атрибуты предыдущих отношений.

Атрибуты:

    f_id                - уникальный идентификатор рейса
    f_flight            - номер рейса (например SU 202)
    f_airline_id        - id авиакомпании которая обслуживает рейс
    f_route             - маршрут следования
    f_time              - дата и время начала рейса
    f_cost              - стоимость рейса на 1 эконом место

Почему у рейса есть и идентификатор и номер рейса одновременно? Потому что номер рейса повторяется с течением времени, а id указывает на уникальность конкретного рейса в данный момент времени.

Видим избыточность в сущности "Рейс". Можно также добавить "Билет", который заберет на себя атрибут cost, или объеденить аэропорт вылета/прилета в один связующий атрибут, который связан с сущностью "Маршруты", но для тренировки пока хватит и этого.

#### Заметка из учебной литературы

Количество сущностей будет непременно расти с каждым уточняющем вопросом к заказчику и от сложности проекта. Поэтому и придуманы уровни абстракции, которые от низкой детализации сущностей постепенно переходят к более высокой степени точности. Не будем проектировать каждый уровень, а остановимся на даталогическом уровне проектирования.

Важно понимать, что ошибки обязательно будут и учесть все сразу не получится. Поэтому проектирование это постоянный процесс в разработке. Так или иначе придется залезть в БД и добавить новые атрибуты или сущности.

### 2. Составление модели

Теперь отобразим сущности в статической UML диаграмме.

Связующие ключи, индексы и уникальность полей в объектах UML диаграммы принято отображать как методы, потому что в контексте СУБД определить, к примеру, ключ - это процесс.




